let stateAllTabs = false;

chrome.commands.onCommand.addListener(command => {
	switch (command) {
		case "mute_tab_current":
			// Alt+Shift+M : Mute/Unmute the selected tab
			chrome.tabs.query({ active: true, lastFocusedWindow: true }, ([currentTab]) => {
				chrome.tabs.update(currentTab.id, { muted: !currentTab.mutedInfo.muted });
			});
			break;

		case "mute_tab_all":
			// Alt+Shift+Comma : Mute/Unmute all audible tabs
			stateAllTabs = !stateAllTabs;
			chrome.tabs.query({}, tabs => {
				tabs
					.filter(tab => tab.audible || tab.mutedInfo.muted)
					.forEach(tab => {
						chrome.tabs.update(tab.id, { muted: stateAllTabs });
					});
			})
			break;

		case "mute_tab_all_except_current":
			// Alt+Shift+N : "Mute all audible tabs except current
			chrome.tabs.query({}, tabs => {
				tabs
					.filter(tab => ((!tab.active) && tab.audible))
					.forEach(tab => {
						chrome.tabs.update(tab.id, { muted: true })
					});
			});
			break;

		default:
			break;
	}
});

{
    "manifest_version": 2,
    "name": "Mute Tab Shortcuts",
    "version": "2.0.0",
    "description": "Quickly mute tabs with keyboard shortcuts",
    "icons": {
        "16": "imgs/16.png",
        "48": "imgs/48.png",
        "128": "imgs/128.png"
    },
    "background": {
        "persisten": false,
        "scripts": [
            "background.js"
        ]
    },
    "commands": {
        "mute_tab_current": {
            "description": "Mute/Unmute the selected tab.",
            "suggested_key": {
                "default": "Alt+Shift+M"
            }
        },
        "mute_tab_all": {
            "description": "Mute/Unmute all audible tabs.",
            "suggested_key": {
                "default": "Alt+Shift+Comma"
            }
        },
        "mute_tab_all_except_current": {
            "description": "Mute all audible tabs except current.",
            "suggested_key": {
                "default": "Alt+Shift+N"
            }
        }
    }
}
